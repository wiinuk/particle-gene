(()=>{"use strict";var t,e,n,r,o={},i={};function c(t){var e=i[t];if(void 0!==e)return e.exports;var n=i[t]={id:t,loaded:!1,exports:{}};return o[t](n,n.exports,c),n.loaded=!0,n.exports}function s(t,...e){const n=String.raw(t,...e.map((t=>"string"==typeof t?t:JSON.stringify(t))));throw new Error(n)}c.m=o,t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",r=t=>{t&&!t.d&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},c.a=(o,i,c)=>{var s;c&&((s=[]).d=1);var a,u,l,f=new Set,h=o.exports,d=new Promise(((t,e)=>{l=e,u=t}));d[e]=h,d[t]=t=>(s&&t(s),f.forEach(t),d.catch((t=>{}))),o.exports=d,i((o=>{var i;a=(o=>o.map((o=>{if(null!==o&&"object"==typeof o){if(o[t])return o;if(o.then){var i=[];i.d=0,o.then((t=>{c[e]=t,r(i)}),(t=>{c[n]=t,r(i)}));var c={};return c[t]=t=>t(i),c}}var s={};return s[t]=t=>{},s[e]=o,s})))(o);var c=()=>a.map((t=>{if(t[n])throw t[n];return t[e]})),u=new Promise((e=>{(i=()=>e(c)).r=0;var n=t=>t!==s&&!f.has(t)&&(f.add(t),t&&!t.d&&(i.r++,t.push(i)));a.map((e=>e[t](n)))}));return i.r?u:c()}),(t=>(t?l(d[n]=t):u(h),r(s)))),s&&(s.d=0)},c.d=(t,e)=>{for(var n in e)c.o(e,n)&&!c.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},c.f={},c.e=t=>Promise.all(Object.keys(c.f).reduce(((e,n)=>(c.f[n](t,e),e)),[])),c.u=t=>t+".index.js",c.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),c.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),c.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),c.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.v=(t,e,n,r)=>{var o=fetch(c.p+""+n+".module.wasm");return"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(o,r).then((e=>Object.assign(t,e.instance.exports))):o.then((t=>t.arrayBuffer())).then((t=>WebAssembly.instantiate(t,r))).then((e=>Object.assign(t,e.instance.exports)))},(()=>{var t;c.g.importScripts&&(t=c.g.location+"");var e=c.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),c.p=t})(),(()=>{var t={811:1};c.f.i=(e,n)=>{t[e]||importScripts(c.p+c.u(e))};var e=self.webpackChunkparticle_gene=self.webpackChunkparticle_gene||[],n=e.push.bind(e);e.push=e=>{var[r,o,i]=e;for(var s in o)c.o(o,s)&&(c.m[s]=o[s]);for(i&&i(c);r.length;)t[r.pop()]=1;n(e)}})();const a={fpsUpdated:{kind:"notify",args:[function(t){return t}]}},u=new WeakMap;function l(t,e){if(e.length===t+1){const t=e[e.length-1];return e.length--,t}}function f(t,e,n){const{kind:r}=e;switch(r){case"notify":return function(t,e,n){const r=e.args.length;return(...e)=>{n.postMessage({kind:"notify",methodName:t,args:e},l(r,e))}}(t,e,n);case"call":return function(t,e,n){const r=e.args.length;return(...e)=>{const o=function(t){const e=u.get(t);if(e)return e;let n=0;const r=new Map,o={newId:function(){return n++},createPromiseFor:function(t){return new Promise(((e,n)=>{r.set(t,(t=>"return"===t.kind?e(t.result):n(t.reason)))}))}};return u.set(t,o),t.addEventListener("message",(t=>{const e=t.data;switch(e.kind){case"return":case"throw":{const{id:t}=e,n=r.get(t);if(!n)throw new Error(`handler ${t} not found`);r.delete(t),n(e)}}})),o}(n),i=o.newId(),c=o.createPromiseFor(i);return n.postMessage({kind:"call",methodName:t,args:e,id:i},l(r,e)),c}}(t,e,n);default:throw new Error(`unexpected kind: ${r}`)}}function h(t,e){return[t,e]}function d(){return h(0,0)}function p(t){return t[0]}function m(t){return t[1]}function g(t,e){return p(t)*p(e)+m(t)*m(e)}function w(t){return Math.sqrt(g(t,t))}function y(t,e,n){return function(t,e){t[0]=e}(t,e),function(t,e){t[1]=e}(t,n),t}function v(t,e,n){return y(n,p(t)-p(e),m(t)-m(e))}class b{constructor(t,e,n){this.position=h(t,e),this.velocity=d(),this.velocity2=d(),this.force=d(),this.pressure=0,this.density=0,this.active=!0,this.kinematic=n}remove(){this.active=!1}}class k{constructor(t,e,n,r){this.width=n,this.height=r,this.left=t,this.right=t+n,this.bottom=e,this.top=e+r}}const P=(x=a,function(t,e){t.addEventListener("message",(n=>{const r=n.data;!function(t,e,n){const{kind:r}=n;switch(r){case"notify":return void e[n.methodName](...n.args);case"call":!function(t,e,n){const r=e.args;let o,i=!1;try{o=(0,t[e.methodName])(...r)}catch(t){i=!0,o=t}const{id:c}=e;i?n.postMessage({kind:"throw",id:c,reason:o}):o instanceof Promise?o.then((t=>{n.postMessage({kind:"return",id:c,result:t})}),(t=>{n.postMessage({kind:"throw",id:c,reason:t})})):n.postMessage({kind:"return",id:c,result:o})}(e,n,t)}}(t,e,r)}))}(S=self,{initialize:async function(t){const{greet_message:e}=await c.e(307).then(c.bind(c,307));console.log(e("test")),E=t.height,j=t.width;const n=t.getContext("2d")??s`キャンバスに描画できません`,r={camera:{centerX:.5,centerY:.5,meterPerViewPortLength:1},context:n,now:performance.now()},o=function(){let t=0,e=null,n=0;return{update:function(r){const{now:o}=r;1e3<=o-n&&(e!==t&&P.fpsUpdated(t),e=t,n=o,t=0),t++}}}(),i=function(){const t=[];function e(n){t.push(e,n)}function n(e){t.push(n,e,performance.now())}function r(e){t.push(r,e,performance.now())}return{log:e,time:n,timeEnd:r,clear:function(){t.length=0},display:function(){const o=[],i=new Map;for(let c=0;c<t.length;){const s=t[c++];switch(s){case e:{const e=t[c++];o.push(String(e));break}case n:{const e=t[c++],n=t[c++];i.set(e,n);break}case r:{const e=t[c++],n=t[c++],r=i.get(e);void 0===r?o.push(`info: Timer '${e}' does not exist`):(o.push(`${e}: ${n-r}ms`),i.delete(e));break}default:o.push(`internal error: ${"function"==typeof s?s.name:s}`)}}return o.join("\n")}}}(),a=function(t){const e=t?.reporter,n=t?.size??h(.9,.9),r=[],o=.01,i=.015,{kernel:c,gradient:s}=function(t){const e=4/(Math.PI*t**8);return{kernel:function(n){return n<t?e*(t*t-n*n)**3:0},gradient:function(n,r){const o=w(n);if(o<t){const i=-6*e*(t*t-o*o)**2;return y(r,i*p(n),i*m(n))}return y(r,0,0)}}}(i),a=h(0,-9.8),{clear:u,add:l,enumerateNeighbors:f}=function(t,e){const n=Math.ceil(p(t)/e),r=Math.ceil(m(t)/e),o=new Array(n*r);for(let t=0;t<o.length;t++)o[t]=[];function i(t){return Math.floor(t/e)}function c(t){return Math.floor(t/e)}const s=d();return{clear:function(){for(let t=0,e=o.length;t<e;t++)o[t].length=0},add:function(t){for(let r=0,s=t.length;r<s;r++){const s=t[r];s.active&&o[(e=s.position,i(p(e))+c(m(e))*n)].push(s)}var e},enumerateNeighbors:function(t,a,u){const{position:l}=t,f=i(p(l)),h=c(m(l));for(let t=f-1;t<=f+1;t++)if(!(t<0||t>=n))for(let i=h-1;i<=h+1;i++){if(i<0||i>=r)continue;const c=o[t+i*n];for(let t=0,n=c.length;t<n;t++){const n=c[t],r=v(l,n.position,s);w(r)>=e||a(n,r,u)}}}}}(n,i),k=.001;let P,S,x=0;function M(t,e){const n=w(e);x+=.1*c(n)}const _=d(),E=d();function j(t,e){const n=P,r=S;if(n===t)return;const o=w(e),c=s(e,_),a=-.1*(t.pressure/(t.density*t.density)+n.pressure/(n.density*n.density));y(r,p(r)+p(c)*a,m(r)+m(c)*a);const u=o*o+.01*i*i,l=v(n.velocity,t.velocity,E),f=.2/(t.density*n.density)*g(e,c)/u;y(r,p(r)+f*p(l),m(r)+f*m(l))}return{particleSize:o,spawnParticlesInRectangle:function(t,{kinematic:e=!1}){const n=Math.round(t.width/o),i=Math.round(t.height/o);for(let c=0;c<n;c++)for(let n=0;n<i;n++){const i=t.left+(c+.5)*o,s=t.bottom+(n+.5)*o;r.push(new b(i,s,e))}},update:function(){e?.time("registerToGrid"),u(),l(r),e?.timeEnd("registerToGrid"),e?.time("calculateForce"),function(){for(let t=0,e=r.length;t<e;t++){const e=r[t];if(!e.active)continue;x=0,f(e,M);const n=x;e.density=n,e.pressure=Math.max(100*(e.density-1e3),0)}}(),function(){for(let n=0,o=r.length;n<o;n++){const o=r[n];if(!o.active||o.kinematic)continue;const i=y(o.force,0,0);P=o,S=i,f(o,j),e=a,y(i,p(t=i)+p(e),m(t)+m(e))}var t,e}(),e?.timeEnd("calculateForce"),e?.time("updateVelocity"),function(){for(let t=0,e=r.length;t<e;t++){const e=r[t];if(!e.active||e.kinematic)continue;const{velocity2:o,force:i,position:c,velocity:s}=e;y(o,p(o)+p(i)*k,m(o)+m(i)*k),y(c,p(c)+p(o)*k,m(c)+m(o)*k),y(s,p(o)+.5*p(i)*k,m(o)+.5*m(i)*k),(p(c)<0||m(c)<0||p(c)>p(n)||m(c)>m(n))&&e.remove()}}(),e?.timeEnd("updateVelocity")},getParticles:function(){return r}}}({reporter:i}),u=.1,l=new k(u,u,.6,.4),f=new k(u,u,.2,.4),S=4*a.particleSize;a.spawnParticlesInRectangle(f,{kinematic:!1});const x=l.width+2*S,O=new k(u-S,u-S,x,S);a.spawnParticlesInRectangle(O,{kinematic:!0});const I=new k(u-S,u,S,l.height);a.spawnParticlesInRectangle(I,{kinematic:!0});const T=new k(l.right,u,S,l.height);a.spawnParticlesInRectangle(T,{kinematic:!0});let R=0;const $=d();requestAnimationFrame((function e(c){requestAnimationFrame(e),r.now=c,o.update(r);const s=Math.min(E,j),u=t.width=s,l=t.height=s;n.clearRect(0,0,u,l),n.fillStyle="black",n.fillRect(0,0,u,l),function(){const{now:t}=r;if(!_.clicked||t<R+100)return;R=t;const[e,n]=function({context:t,camera:e},n,r,o=d()){const i=t.canvas.width,c=i/e.meterPerViewPortLength,s=.5*i;return o[0]=(n-s)/c+e.centerX,o[1]=(r-s)/-c+e.centerY,o}(r,_.canvasX,_.canvasY);a.spawnParticlesInRectangle(new k(e,n,a.particleSize,a.particleSize),{kinematic:!1})}(),n.fillStyle="red",n.beginPath(),n.ellipse(_.canvasX,_.canvasY,10,10,0,0,2*Math.PI),n.fill(),i.time("drawing"),function(){const t=function({context:t,camera:e}){return t.canvas.width/e.meterPerViewPortLength}(r);for(const{active:e,position:[o,i],kinematic:c}of a.getParticles()){if(!e)continue;const[s,u]=M(r,o,i,$),l=a.particleSize*t*.5;n.beginPath(),n.fillStyle=c?"rgba(45, 45, 45, 0.5)":"rgba(173, 216, 230, 0.5)",n.arc(s,u,l,0,2*Math.PI),n.fill()}}(),i.timeEnd("drawing");for(let t=0;t<5;t++)a.update();!function(){const t=i.display();i.clear(),n.fillStyle="white";const e=t.split("\n");let r=0;for(const t of e)r+=n.measureText(t).fontBoundingBoxAscent,n.fillText(t,0,r)}()}))},mouseDown(){_.clicked=!0},mouseUp(){_.clicked=!1},mouseMove(t,e){_.canvasX=t,_.canvasY=e},canvasWrapperResized(t,e){E=t,j=e}}),function(t,e){const n=Object.create(null);return Object.keys(e).forEach((r=>{n[r]=f(r,e[r],t)})),n}(S,x));var S,x;function M({context:t,camera:e},n,r,o){const i=t.canvas.width,c=i/e.meterPerViewPortLength,s=.5*i;return o[0]=(n-e.centerX)*c+s,o[1]=(r-e.centerY)*-c+s,o}const _={clicked:!1,canvasX:0,canvasY:0};let E=0,j=0})();